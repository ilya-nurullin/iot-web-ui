# Руководство пользователя конструктором сценарий <!-- omit in toc -->

## Содержание <!-- omit in toc -->

- [Описание интерфейса](#%d0%9e%d0%bf%d0%b8%d1%81%d0%b0%d0%bd%d0%b8%d0%b5-%d0%b8%d0%bd%d1%82%d0%b5%d1%80%d1%84%d0%b5%d0%b9%d1%81%d0%b0)
- [Составление сценария](#%d0%a1%d0%be%d1%81%d1%82%d0%b0%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d1%81%d1%86%d0%b5%d0%bd%d0%b0%d1%80%d0%b8%d1%8f)
  - [Основы](#%d0%9e%d1%81%d0%bd%d0%be%d0%b2%d1%8b)
  - [Переменные](#%d0%9f%d0%b5%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%bd%d1%8b%d0%b5)
  - [Функции](#%d0%a4%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b8)
  - [Экспорт](#%d0%ad%d0%ba%d1%81%d0%bf%d0%be%d1%80%d1%82)
  - [Импорт](#%d0%98%d0%bc%d0%bf%d0%be%d1%80%d1%82)
  - [Развёртывание](#%d0%a0%d0%b0%d0%b7%d0%b2%d1%91%d1%80%d1%82%d1%8b%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5)
- [Описание блоков](#%d0%9e%d0%bf%d0%b8%d1%81%d0%b0%d0%bd%d0%b8%d0%b5-%d0%b1%d0%bb%d0%be%d0%ba%d0%be%d0%b2)
  - [Logic](#logic)
    - [If](#if)
    - [Boolean](#boolean)
  - [Loops](#loops)
  - [Math](#math)
  - [List](#list)
  - [Text](#text)
  - [IO](#io)


## Описание интерфейса

![Основное окно программы](./pics/Interface1.PNG)
*Основное окно программы*

Слева расположено меню выбора блоков сценария. Доступные блоки подразделяются на категории: Logic, Math, Lists, Text, IO и специальные блоки Variables и Functions. Подробное описание блоков расположено [ниже](#%d0%9e%d0%bf%d0%b8%d1%81%d0%b0%d0%bd%d0%b8%d0%b5-%d0%b1%d0%bb%d0%be%d0%ba%d0%be%d0%b2).
При нажатии на категорию становятся доступны блоки из данной категории.

![Блоки категории "Math"](./pics/Mathblocks1.PNG)
*Блоки категории "Math"*

Данные блоки могут быть помещены в сценарий путём их перетаскивания на рабочую область. Для удаления блока из рабочей области перетащите его в корзину в левом-нижнем углу.

![](./pics/OneBlock.PNG)

Под основным полем расположено текстовое поле, выполняющее функцию отображения превью генерирующегося кода на языке Python, а также для [экспорта](#%d0%ad%d0%ba%d1%81%d0%bf%d0%be%d1%80%d1%82) и [импорта](#%d0%98%d0%bc%d0%bf%d0%be%d1%80%d1%82) сценария в формате XML. Под данным текстовым полем расположены кнопки [экспорта](#%d0%ad%d0%ba%d1%81%d0%bf%d0%be%d1%80%d1%82) - "To XML", [импорта](#%d0%98%d0%bc%d0%bf%d0%be%d1%80%d1%82) - "From XML", и [развёртывания](#%d0%a0%d0%b0%d0%b7%d0%b2%d1%91%d1%80%d1%82%d1%8b%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5) - "Deploy"

![](./pics/Interface2.PNG)

## Составление сценария

### Основы

Все блоки, подобно пазлам, могут быть присоеденены друг к другу. Для этого просто перетаскивайте блоки так, чтобы их соединения совпали. 

![](./pics/SomeBlocks.PNG)

*Примеры блоков*


Каждый блок может обладать несколькими из 4-х видов соединения:
1. Левое соединение. Данный тип соединения означает, что данный блок может быть использован в качестве значения другим блоком с правым соединением. Например, блок: константное число сам по себе представляет из себя числовое значение, в то время, как блок длины строки "length of" предоставляет результат оценки длины строки.
2. Правое соединение. Данный тип соединения означает, что данный блок требует на вход некоторое значение, т.е. необходимо присоединить блок с левым соединением. Например блоки "length of" и "print" ожидают строку.
3. Верхнее соединение. Данный тип соединения означает, что данный блок является командой и его можно соединить с нижним соединением: в этом случае устанавливается порядок исполнения: сначала верхний блок, затем нижний. Например блок "print" явно является командой.
4. Нижнее соединение. Данный тип соединения означает, что после данного блока возможно исполнение команд. Каждая команда имеет данное соединение, однако данное соединение есть также и у специальных блоков: определений [функции](#%d0%a4%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b8).

**Важные правила составления сценария:**
- Лучше не оставлять блоки "летающими в воздухе". Блоки-значения имеют значение только присоединёнными к команде. Соединённые блоки-команды лучше показывают порядок исполнения сценария.
- Если остались правые соединения без значений, то скорее всего была допущена ошибка и требуется добавить соответствующий блок-значение.  

### Переменные
Если открыть закладку "Variables" будет доступны блоки для работы с переменными.

![](./pics/Variable1.PNG)

Для создания новой переменной нажмите "Create variable...", введите название переменной в всплывающем окне и нажмите OK.

![](./pics/Variable2.PNG)

Переменные используются при помощи трёх блоков:
1. set *переменная* to *значение* - операция присваивания
2. change *переменная* by *значение* - операция инкремент
3. *переменная* - использование значения переменной

![](./pics/Variable3.PNG)

### Функции

Для возможности переиспользования сценариев можно создавать функции. На вкладке Functions доступны 4 вида блоков:
1. объявление функции без возврата значения
2. объявление функции с возвратом значения
3. условный возврат значения
4. блоки вывоза функций.

![](./pics/Function.PNG)

Для определения функции перетащите блок объявления функции на рабочее поле. В поле "to" указывается название функции. При нажатии на шестерёнку открывается меню, в котором блоками указываются входные параметры функции.

![](./pics/Function1.PNG)

Внутрь данного блока помещаются блоки-команды для данной функции. Входные параметры доступны на вкладке "Variables".

![](./pics/Function2.PNG)

Полученные функции можно вызывать при помощи соответствующего блока.

![](./pics/Function3.PNG)

Блоки объявления функций не являются командами, поэтому не могут быть присоеденены к основным командам сценария. Тем не менее, рекомендуется помещать все объявления функций выше команд основного сценария и не на большом расстоянии друг от друга.

### Экспорт

Полученные сценарии можно сохранять в формате XML для дальнейшего переиспользования. В частности, имеет смысл создать некоторый набор стандартных функций-сценариев и загружать его при необходимости.

Чтобы получить XML текущего сценария нажмите кнопку "To XML". В текстовом поле появится XML сценария, который может быть сохранён при помощи любого текстового редактора.

![](./pics/Export.PNG)

### Импорт

Для импорта сценария вставьте XML сценария в текстовое поле и нажмите "From XML". На рабочем поле должны появиться блоки сценария, а в текстовом поле - превью кода на Python. 

### Развёртывание

Для развёртывания сценария нажмите кнопку "Deploy". В появившемся всплывающем окне введите название сценария, и нажмите ОК. Ещё раз проверьте правильность сценария и подтвердите отправку сценария на исполнение. 

## Описание блоков

### Logic

Данная категория имеет 2 подкатегории: If и Boolean

#### If


| Блок | Левое соединение | Правое соединение | Верхнее/нижнее соединение | Описание |
|------|------------------|-------------------|---------------------------|----------|
|![](./pics/Ifs.PNG)|Нет|Булево значение|Да|Условный оператор          |

#### Boolean

| Блок | Левое соединение | Правое соединение | Верхнее/нижнее соединение | Описание |
|------|------------------|-------------------|---------------------------|----------|
|![](./pics/Compare.PNG)|Булево значение|Два значения|Нет|Оператор сравнения. Можно выбрать операции: равно, не равно, больше, не больше, меньше, не меньше|
|![](./pics/Logic.PNG)|Булево значение|Два булевых значения|Нет|Булевы операции. Можно выбрать: AND, OR|
|![](./pics/Not.PNG)|Булево значение|Булево значение|Нет|Операция "НЕ". Инвертирует булево значение|
|![](./pics/BoolConst.PNG)|Булево значение| Нет | Нет | Булева константа. Можно выбрать true, false|
|![](./pics/Null.PNG)|Значение null|Нет|Нет|Константа null|
|![](./pics/Test.PNG)|Булево значение|Test - булево значение, остальные - любые значения| Нет| Тернарный оператор сравнения. Если значение "test" - правдиво возвращает значение из "if true", иначе возвращает значение из "if false"|

### Loops

| Блок | Левое соединение | Правое соединение | Верхнее/нижнее соединение | Описание |
|------|------------------|-------------------|---------------------------|----------|
|![](./pics/NTimes.PNG)|Нет|Целое число|Верхнее и нижнее + нижнее для тела цикла|Выполнить тело цикла N раз
|![](./pics/While.PNG)|Нет|Булево значение|Верхнее и нижнее + нижнее для тела цикла|Выполнить тело цикла в зависимости от условия. Можно выбрать: while - исполнять пока выполняется условие, until - исполнять до тех пор, пока не выполнится условие
|![](./pics/For.PNG)|Нет|3 числа|Верхнее и нижнее + нижнее для тела цикла|Выполнить тело цикла, изменяя значение переменной i от значения "from" до "to" по "by". По-умолчанию заводится переменная i, можно выбирать любую другую переменную
|![](./pics/ForEach.PNG)|Нет|Список|Верхнее и нижнее + нижнее для тела цикла|Выполнить тело цикла, изменяя значение переменной j от первого до последнего элемента списка. По-умолчанию заводится переменная о, можно выбирать любую другую переменную
|![](./pics/Break.PNG)|Нет|Нет|Только верхнее|Выйти из цикла (если выбрано "break"), или перейти к следующей итерации цикла (если выбрано "continue"). Данный блок должен находиться внутри цикла

### Math

| Блок | Левое соединение | Правое соединение | Верхнее/нижнее соединение | Описание |
|------|------------------|-------------------|---------------------------|----------|
|![](./pics/Number.PNG)|Число|Нет|Нет|Числовая константа|
|![](./pics/Sum.PNG)|Число|Два числа|Нет|Арифметическая операция. Можно выбрать "+","-",...|
|![](./pics/Algebra.PNG)|Число|Число|Нет|Унарная функция. Можно выбрать: "square root" - квадратный корень, "absolute" - модуль числа, "-" - унарный минус, "ln" - натуральный логарифм и другие
|![](./pics/Trig.PNG)|Число|Число|Нет|Тригонометрическая функция. Можно выбрать синус, косинус, тангенс, и им обратные.
|![](./pics/MathConst.PNG)|Число|Нет|Нет|Математическая константа. Можно выбрать пи, е, золотое сечение, корень из 2, корень из одной второй или бесконечность
|![](./pics/Even.PNG)|Булево значение|Число|Нет|Проверка числа. Можно проверять на чётность/нечётность, простоту, целость, знак и на делимость. Если выбрана проверка на делимость, то появляется ещё одно правое соединение для числа, на которое должно делиться данное
|![](./pics/Aggregate.PNG)|Число|Лист чисел|Нет|Агрегация листа чисел. Можно вернуть сумму, минимум, максимум, и другие
|![](./pics/Contains.PNG)|Булево значение|3 числа|Нет |Исправляет число, если оно больше high или меньше low на high и low соответственно
|![](./pics/RandInt.PNG)|Число|2 числа|Нет| Случайное целое число в промежутке от "from" до "to"|
|![](./pics/Rand.PNG)|Число|Нет|Нет|Случайное вещественное число от 0 (включительно) до 1 (не включительно)

### List
| Блок | Левое соединение | Правое соединение | Верхнее/нижнее соединение | Описание |
|------|------------------|-------------------|---------------------------|----------|
|![](./pics/EmptyList.PNG)|Лист|Нет|Нет|Создаёт список без элементов
|![](./pics/InitList.PNG)|Лист|N значений|Нет|Создаёт список из элементов. Нажмите на шестерёнку для задания количества элементов
|![](./pics/InitListRepeat.PNG)|Лист|Два значения, первое - любое, второе - целое|Нет|Создаёт список повторяя элемент N раз
|![](./pics/ListLength.PNG)|Число|Лист|Нет|Возвращает длину листа
|![](./pics/IsEmpty.PNG)|Булево значение|Лист|Нет|Возвращает пуст ли лист
|![](./pics/IsEmpty.PNG)|Булево значение|Лист|Нет|Возвращает пуст ли лист
|![](./pics/Find.PNG)|Число|Лист и любое значение|Нет|Возвращает первый или последний индекс данного элемента в листе
|![](./pics/ListGet.PNG)|Значение|Лист и число|Нет|Возвращает элемент листа на выбор: N-ый, N-ый с конца, первый, последний, случайный
|![](./pics/SetList.PNG)|Нет|Лист, число и любое значение|Да|Устанавливает на выбор N-ый, N-ый с конца, первый, последний, случайный элемент листа равным данному

### Text
| Блок | Левое соединение | Правое соединение | Верхнее/нижнее соединение | Описание |
|------|------------------|-------------------|---------------------------|----------|
|![](./pics/StringConst.PNG)|Строка|Нет|Нет|Строковая константа
|![](./pics/StringLength.PNG)|Число|Строка|Нет|Возвращает длину строки
|![](./pics/Print.PNG)|Нет|Строка|Да|Вывод строки. Используется только для отладки сценариев

### IO
| Блок | Левое соединение | Правое соединение | Верхнее/нижнее соединение | Описание |
|------|------------------|-------------------|---------------------------|----------|
|![](./pics/Input.PNG)|Значение|2 строки|Нет|Возвращает значение измерения "measurement" из таблицы "table"
|![](./pics/Output.PNG)|Нет|2 строки|Да|Отправляет в топик "query" JSON-строку




